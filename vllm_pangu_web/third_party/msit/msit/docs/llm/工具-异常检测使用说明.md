# 异常检测

提供模型推理过程中出现的异常检测能力，如算子溢出、内存踩踏等，当前仅支持算子溢出检测。

算子溢出检测分为饱和模式和非饱和模式（加速库自动设置），目前都只支持 Atlas 800I A2 推理卡.

## 使用方式：

```shell
msit llm errcheck --exec <模型推理脚本> [--type <异常检测类型>] [--output <输出结果路径>] [--exit] [--log-level <日志级别>]
```
其中 `[]` 内表示可选，`<>` 表示参数

## 参数说明

| 参数名          | 描述                                                                                                                                                                                           | 是否必选 |
| --------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| --exec          | 指定拉起推理执行命令，使用示例： --exec "bash run.sh patches/models/modeling_xxx.py"。**注：用户需自行保证执行命令的安全性，并承担因输入不当而导致的任何安全风险或损失；命令中不支持重定向字符，如果需要重定向输出，建议将执行命令写入 shell 脚本，然后启动 shell 脚本。** | 是       |
| --type          | 异常检测类型，可选值['overflow']，当前仅支持溢出检测                                                                                                                                           | 否       |
| --exit          | 检测到异常后进程是否退出，默认不退出                                                                                                                                                             | 否       |
| --output, -o    | 检测结果输出目录，默认为当前目录，如果没有异常则不输出结果文件                                                                                                                                 | 否       |
| --log-level, -l | 日志级别，默认为 info，可选值有：debug, info, warning, error, fatal, critical                                                                                                                             | 否       |
| --help, -h | 命令行参数帮助信息                                                                                                                     | 否       |

## 结果查看
存放结果的目录默认为当前文件夹下，用户可以通过 `-o` 指定想要存放的路径

路径下，会生成 `.txt` 格式的文件，文件的命名格式为 `msit_overflow_res_<pid>.txt`。文件的内容为 `Overflow detected! Operator name: <Op 名称>:<kernel 名称>`

比如生成一个 `msit_overflow_res_1148917.txt` 的文件，说明进程号是 `1148917`。其内容为 `Overflow detected! Operator name: ElewiseOperation_1:AddF32Tactic`，代表 `Op` 名称 为 `ElewiseOperation_1`，`kernel` 名称为 `AddF32Tactic`